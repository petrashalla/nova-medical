{"version":3,"file":"request.js","sources":["request.js"],"sourcesContent":["document.addEventListener('DOMContentLoaded', () => {\r\n\r\n    const style = document.createElement('style');\r\n    style.type = 'text/css';\r\n    style.innerHTML = `.custom-error {\r\n        outline: 1px solid red !important;\r\n        }`;\r\n    document.head.appendChild(style);\r\n\r\n    function clearInput(button) {\r\n        const input = button.parentNode.querySelector('input');\r\n        input.value = '';\r\n        toggleClearButton(button);\r\n    }\r\n\r\n    function toggleClearButton(button) {\r\n        const input = button.parentNode.querySelector('input');\r\n        const clearButton = button;\r\n        if (input.value.length > 0) {\r\n            clearButton.style.display = 'block';\r\n        } else {\r\n            clearButton.style.display = 'none';\r\n        }\r\n    }\r\n\r\n    const clearInputButtons = document.querySelectorAll('.input-clear');\r\n    clearInputButtons.forEach(button => {\r\n        const input = button.parentNode.querySelector('input');\r\n        input.addEventListener('input', () => toggleClearButton(button));\r\n        toggleClearButton(button);\r\n        button.addEventListener('click', () => clearInput(button));\r\n    });\r\n\r\n    ;[].forEach.call(\r\n        document.querySelectorAll('input[type=tel]'),\r\n        function (input) {\r\n            let keyCode\r\n            function mask(event) {\r\n                event.keyCode && (keyCode = event.keyCode)\r\n                let pos = this.selectionStart\r\n                if (pos < 3) event.preventDefault()\r\n                let matrix = '+7 (___) ___-__-__',\r\n                    i = 0,\r\n                    def = matrix.replace(/\\D/g, ''),\r\n                    val = this.value.replace(/\\D/g, ''),\r\n                    new_value = matrix.replace(/[_\\d]/g, function (a) {\r\n                        return i < val.length ? val.charAt(i++) || def.charAt(i) : a\r\n                    })\r\n                i = new_value.indexOf('_')\r\n                if (i != -1) {\r\n                    i < 5 && (i = 3)\r\n                    new_value = new_value.slice(0, i)\r\n                }\r\n                let reg = matrix\r\n                    .substr(0, this.value.length)\r\n                    .replace(/_+/g, function (a) {\r\n                        return '\\\\d{1,' + a.length + '}'\r\n                    })\r\n                    .replace(/[+()]/g, '\\\\$&')\r\n                reg = new RegExp('^' + reg + '$')\r\n                if (\r\n                    !reg.test(this.value) ||\r\n                    this.value.length < 5 ||\r\n                    (keyCode > 47 && keyCode < 58)\r\n                )\r\n                    this.value = new_value\r\n                if (event.type == 'blur' && this.value.length < 5) this.value = ''\r\n            }\r\n            input.addEventListener('input', mask, false)\r\n            input.addEventListener('focus', mask, false)\r\n            input.addEventListener('blur', mask, false)\r\n            input.addEventListener('keydown', mask, false)\r\n        }\r\n    )\r\n    function GetYMCID() {\r\n        var match = document.cookie.match('(?:^|;)\\\\s*_ym_uid=([^;]*)');\r\n        return (match) ? decodeURIComponent(match[1]) : false;\r\n    }\r\n    const formButtons = document.querySelectorAll('button[type=\"submit\"]');\r\n\r\n    let key = mes = '';\r\n    const ajaxSend = async (formData) => {\r\n        const response = await fetch(\"/netcat_template/ajax/hash-check.php\", {\r\n            method: \"POST\",\r\n            body: formData\r\n        });\r\n        if (!response.ok) {\r\n            throw new Error(`Ошибка по адресу hash-check, статус ошибки ${response.status}`);\r\n        }\r\n        return await response.text();\r\n    };\r\n    const formData = new FormData();\r\n    if (document.querySelectorAll('input[name=mes]').length > 0) {\r\n        mes = document.querySelectorAll('input[name=mes]')[document.querySelectorAll('input[name=mes]').length - 1].value;\r\n    }\r\n    formData.append('checker', 1);\r\n    formData.append('mes', mes);\r\n    ajaxSend(formData)\r\n        .then((response) => {\r\n            key = response;\r\n            return key;\r\n        })\r\n        .catch((err) => console.error(err));\r\n\r\n    formButtons.forEach(button => {\r\n        const formObj = button.parentNode;\r\n        const divWrap = document.createElement('div');\r\n        divWrap.style.display = 'none';\r\n        divWrap.innerHTML =\r\n            `<input name=\"trafficSource\" type=\"hidden\" value=\"\">\r\n            <input name=\"istochnik\" type=\"hidden\" value=\"\">\r\n            <input name=\"clientID\" type=\"hidden\" value=\"${GetYMCID()}\">`;\r\n        formObj.appendChild(divWrap);\r\n\r\n        if (typeof sbjs !== 'undefined') {\r\n            sbjs.init(divWrap);\r\n            formObj.querySelector(\"input[name=trafficSource]\").value = sbjs.get.current.typ;\r\n            formObj.querySelector(\"input[name=istochnik]\").value = sbjs.get.current.src;\r\n        }\r\n\r\n        function getRandomNumber(min, max) {\r\n            return Math.ceil(Math.random() * (max - min)) + min - 1;\r\n        }\r\n        setTimeout(function () {\r\n            if (key != '') {\r\n                const input = document.createElement('input');\r\n                input.name = 'f_haystack';\r\n                input.type = 'hidden';\r\n                input.value = key;\r\n                formObj.appendChild(input);\r\n            }\r\n        }, getRandomNumber(5000, 7000));\r\n        const responeModalOk = document.querySelector('[data-modal-ok]');\r\n        const responeModalError = document.querySelector('[data-modal-err]');\r\n        button.addEventListener('click', async function (event) {\r\n            event.preventDefault();\r\n            const form = this.closest('form');\r\n            modalOpen = responeModalOk.dataset.modalOpen;\r\n            const fields = {};\r\n            const inputs = form.querySelectorAll('input[type=\"tel\"], textarea, input[type=\"text\"]');\r\n            inputs.forEach(input => {\r\n                if (input.hasAttribute('required')) {\r\n                    fields[input.name] = {\r\n                        type: input.type,\r\n                        value: input.value\r\n                    };\r\n                }\r\n            })\r\n            if (responeModalOk === responeModalError) {\r\n                modalOk = modalErr = responeModalOk.querySelector('.' + responeModalOk.dataset.modalOk);\r\n            } else {\r\n                modalOk = responeModalOk.querySelector('.' + responeModalOk.dataset.modalOk);\r\n                modalErr = responeModalError.querySelector('.' + responeModalError.dataset.modalErr);\r\n            }\r\n            const resultWrappers = {\r\n                success: modalOk,\r\n                error: modalErr\r\n            };\r\n            if (validateInputs(fields)) {\r\n                await handleSubmission(this, form, resultWrappers, modalOpen);\r\n            } else {\r\n                markErrors(form);\r\n            }\r\n        });\r\n\r\n        const urlInputs = document.querySelectorAll(\"input[name='urlMessage'], input[name='title_url_message']\");\r\n        urlInputs.forEach(input => {\r\n            const cleanUrl = `${window.location.origin}${window.location.pathname}`;\r\n            input.value = input.name === 'urlMessage' ? cleanUrl : document.title;\r\n        });\r\n    });\r\n\r\n    async function handleSubmission(button, form, resultWrappers, modalOpen) {\r\n        const originalText = button.innerText;\r\n        button.innerHTML = \"Отправление\";\r\n        button.disabled = true;\r\n        try {\r\n            const response = await fetch(`/netcat_template/ajax/request.php`, {\r\n                method: 'POST',\r\n                body: new FormData(form)\r\n            });\r\n            const responseText = await response.text();\r\n            const isSuccess = response.ok;\r\n            openModal(isSuccess ? resultWrappers.success : resultWrappers.error, responseText, modalOpen);\r\n\r\n        } catch (error) {\r\n            openModal(resultWrappers.error, error.message, modalOpen);\r\n        } finally {\r\n            resetButton(button, originalText);\r\n        }\r\n    }\r\n\r\n    function openModal(wrapper, content, modalOpen) {\r\n\r\n        const modal = wrapper.closest('.popup');\r\n        wrapper.innerHTML = content;\r\n        const classes = modalOpen.split(' ');\r\n        classes.forEach(item => {\r\n            modal.classList.add(item);\r\n        });\r\n    }\r\n    function resetButton(button, buttonText) {\r\n        button.innerText = buttonText;\r\n        button.disabled = false;\r\n    }\r\n\r\n    function markErrors(form) {\r\n        const inputs = form.querySelectorAll('input[type=\"tel\"], textarea, input[type=\"text\"]');\r\n        inputs.forEach(input => {\r\n            switch (input.type) {\r\n                case 'tel':\r\n                    const phoneNumber = input.value.replace(/\\D/g, '');\r\n                    if (phoneNumber.length < 11) {\r\n                        addErrorStyleNotification(input, \"Введите верный номер телефона\");\r\n                        setTimeout(() => {\r\n                            removeErrorStyleNotification(input);\r\n                        }, 2000);\r\n                    }\r\n                    break;\r\n                case 'textarea':\r\n                case 'text':\r\n                    if (!/[а-яА-ЯёЁ]/.test(input.value) || input.value.trim().length <= 2) {\r\n                        addErrorStyleNotification(input, \"Текст должен содержать русские буквы\");\r\n                        setTimeout(() => {\r\n                            removeErrorStyleNotification(input);\r\n                        }, 2000);\r\n                    }\r\n                    break;\r\n                default:\r\n                    addErrorStyleNotification(input, \"Поле не заполнено\");\r\n                    setTimeout(() => {\r\n                        removeErrorStyleNotification(input);\r\n                    }, 1000);\r\n                    break;\r\n            }\r\n        })\r\n    }\r\n\r\n    function validateInputs(fields) {\r\n        let isValid = true;\r\n        for (let fieldName in fields) {\r\n            const field = fields[fieldName];\r\n            switch (field.type) {\r\n                case 'tel':\r\n                    const phoneNumber = field.value.replace(/\\D/g, '');\r\n                    if (phoneNumber.length < 11) {\r\n                        isValid = false;\r\n                    }\r\n                    break;\r\n                case 'textarea':\r\n                case 'text':\r\n                    if (!/[а-яА-ЯёЁ]/.test(field.value) || field.value.trim().length <= 2) {\r\n                        isValid = false;\r\n                    }\r\n                    break;\r\n                default:\r\n                    isValid = false;\r\n                    break;\r\n            }\r\n        }\r\n        return isValid;\r\n    }\r\n    function addErrorStyleNotification(input, text) {\r\n        input.classList.add('custom-error');\r\n        input.setCustomValidity(text);\r\n        input.reportValidity();\r\n    }\r\n    function removeErrorStyleNotification(input) {\r\n        input.setCustomValidity('')\r\n        input.classList.remove('custom-error');\r\n    }\r\n});"],"names":["document","addEventListener","style","createElement","toggleClearButton","button","input","parentNode","querySelector","value","length","clearButton","display","type","innerHTML","head","appendChild","querySelectorAll","forEach","call","let","keyCode","mask","event","this","selectionStart","preventDefault","matrix","i","def","replace","val","new_value","a","charAt","indexOf","slice","reg","substr","RegExp","test","formButtons","key","mes","formData","FormData","openModal","wrapper","content","modalOpen","modal","closest","split","item","classList","add","addErrorStyleNotification","text","setCustomValidity","reportValidity","removeErrorStyleNotification","remove","append","async","response","await","fetch","method","body","ok","Error","status","then","catch","console","error","err","formObj","min","divWrap","match","cookie","decodeURIComponent","sbjs","init","get","current","typ","src","setTimeout","name","max","Math","ceil","random","responeModalOk","responeModalError","form","dataset","fields","hasAttribute","modalOk","modalErr","resultWrappers","success","isValid","fieldName","field","trim","handleSubmission","originalText","innerText","disabled","responseText","message","buttonText","cleanUrl","window","location","origin","pathname","title"],"mappings":"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"}
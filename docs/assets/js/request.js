document.addEventListener("DOMContentLoaded",()=>{var e=document.createElement("style");function a(e){var t=e.parentNode.querySelector("input");0<t.value.length?e.style.display="block":e.style.display="none"}e.type="text/css",e.innerHTML=`.custom-error {
        outline: 1px solid red !important;
        }`,document.head.appendChild(e),document.querySelectorAll(".input-clear").forEach(t=>{t.parentNode.querySelector("input").addEventListener("input",()=>a(t)),a(t),t.addEventListener("click",()=>{var e;(e=t).parentNode.querySelector("input").value="",a(e)})}),[].forEach.call(document.querySelectorAll("input[type=tel]"),function(e){let u;function t(e){e.keyCode&&(u=e.keyCode),this.selectionStart<3&&e.preventDefault();let t="+7 (___) ___-__-__",a=0,n=t.replace(/\D/g,""),r=this.value.replace(/\D/g,""),l=t.replace(/[_\d]/g,function(e){return a<r.length?r.charAt(a++)||n.charAt(a):e});-1!=(a=l.indexOf("_"))&&(a<5&&(a=3),l=l.slice(0,a));var o=t.substr(0,this.value.length).replace(/_+/g,function(e){return"\\d{1,"+e.length+"}"}).replace(/[+()]/g,"\\$&");(!(o=new RegExp("^"+o+"$")).test(this.value)||this.value.length<5||47<u&&u<58)&&(this.value=l),"blur"==e.type&&this.value.length<5&&(this.value="")}e.addEventListener("input",t,!1),e.addEventListener("focus",t,!1),e.addEventListener("blur",t,!1),e.addEventListener("keydown",t,!1)});e=document.querySelectorAll('button[type="submit"]');let r=mes="";var t=new FormData;function d(e,t,a){let n=e.closest(".popup");e.innerHTML=t,a.split(" ").forEach(e=>{n.classList.add(e)})}function p(e,t){e.classList.add("custom-error"),e.setCustomValidity(t),e.reportValidity()}function m(e){e.setCustomValidity(""),e.classList.remove("custom-error")}0<document.querySelectorAll("input[name=mes]").length&&(mes=document.querySelectorAll("input[name=mes]")[document.querySelectorAll("input[name=mes]").length-1].value),t.append("checker",1),t.append("mes",mes),(async e=>{e=await fetch("/netcat_template/ajax/hash-check.php",{method:"POST",body:e});if(e.ok)return e.text();throw new Error("Ошибка по адресу hash-check, статус ошибки "+e.status)})(t).then(e=>r=e).catch(e=>console.error(e)),e.forEach(e=>{let t=e.parentNode;var a,n=document.createElement("div");n.style.display="none",n.innerHTML=`<input name="trafficSource" type="hidden" value="">
            <input name="istochnik" type="hidden" value="">
            <input name="clientID" type="hidden" value="${a=document.cookie.match("(?:^|;)\\s*_ym_uid=([^;]*)"),!!a&&decodeURIComponent(a[1])}">`,t.appendChild(n),"undefined"!=typeof sbjs&&(sbjs.init(n),t.querySelector("input[name=trafficSource]").value=sbjs.get.current.typ,t.querySelector("input[name=istochnik]").value=sbjs.get.current.src),setTimeout(function(){var e;""!=r&&((e=document.createElement("input")).name="f_haystack",e.type="hidden",e.value=r,t.appendChild(e))},(a=5e3,n=7e3,Math.ceil(Math.random()*(n-a))+a-1));let i=document.querySelector("[data-modal-ok]"),s=document.querySelector("[data-modal-err]");e.addEventListener("click",async function(e){e.preventDefault();e=this.closest("form");modalOpen=i.dataset.modalOpen;let t={};e.querySelectorAll('input[type="tel"], textarea, input[type="text"]').forEach(e=>{e.hasAttribute("required")&&(t[e.name]={type:e.type,value:e.value})}),i===s?modalOk=modalErr=i.querySelector("."+i.dataset.modalOk):(modalOk=i.querySelector("."+i.dataset.modalOk),modalErr=s.querySelector("."+s.dataset.modalErr));var a={success:modalOk,error:modalErr};if((e=>{let t=!0;for(var a in e){var n=e[a];switch(n.type){case"tel":n.value.replace(/\D/g,"").length<11&&(t=!1);break;case"textarea":case"text":(!/[а-яА-ЯёЁ]/.test(n.value)||n.value.trim().length<=2)&&(t=!1);break;default:t=!1}}return t})(t)){var n=this,r=e,l=modalOpen,o=n.innerText;n.innerHTML="Отправление",n.disabled=!0;try{var u=await fetch("/netcat_template/ajax/request.php",{method:"POST",body:new FormData(r)}),c=await u.text();d(u.ok?a.success:a.error,c,l)}catch(e){d(a.error,e.message,l)}finally{((e,t)=>{e.innerText=t,e.disabled=!1})(n,o)}}else e.querySelectorAll('input[type="tel"], textarea, input[type="text"]').forEach(e=>{switch(e.type){case"tel":e.value.replace(/\D/g,"").length<11&&(p(e,"Введите верный номер телефона"),setTimeout(()=>{m(e)},2e3));break;case"textarea":case"text":(!/[а-яА-ЯёЁ]/.test(e.value)||e.value.trim().length<=2)&&(p(e,"Текст должен содержать русские буквы"),setTimeout(()=>{m(e)},2e3));break;default:p(e,"Поле не заполнено"),setTimeout(()=>{m(e)},1e3)}})}),document.querySelectorAll("input[name='urlMessage'], input[name='title_url_message']").forEach(e=>{var t=""+window.location.origin+window.location.pathname;e.value="urlMessage"===e.name?t:document.title})})});
//# sourceMappingURL=request.js.map
